#!/bin/sh
# Cursor Memory: auto-rebuild indexes + lint before commit

echo "[CursorMemory] Rebuilding indexes..."
if command -v powershell.exe >/dev/null 2>&1; then
  powershell.exe -ExecutionPolicy Bypass -File "./scripts/memory/rebuild-memory-index.ps1" || exit 1
  powershell.exe -ExecutionPolicy Bypass -File "./scripts/memory/lint-memory.ps1" || exit 1
elif command -v pwsh >/dev/null 2>&1; then
  pwsh -ExecutionPolicy Bypass -File "./scripts/memory/rebuild-memory-index.ps1" || exit 1
  pwsh -ExecutionPolicy Bypass -File "./scripts/memory/lint-memory.ps1" || exit 1
fi

git add .cursor/memory/lessons/index.md 2>/dev/null
git add .cursor/memory/lessons-index.json 2>/dev/null
git add .cursor/memory/journal-index.md 2>/dev/null
git add .cursor/memory/journal-index.json 2>/dev/null
git add .cursor/memory/digests/*.digest.md 2>/dev/null

exit 0